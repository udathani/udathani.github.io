<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Cicil BTC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WRCC7X20YJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-WRCC7X20YJ');
  </script>

  <style>
    :root{
      --fg:#111;
      --muted:#555;
      --line:#eee;
      --bg:#fff;
    }
    *{box-sizing:border-box}
    body{
      max-width:720px;
      margin:56px auto;
      padding:0 20px;
      line-height:1.6;
      color:var(--fg);
      background:var(--bg);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    }
    h1{margin:0 0 14px;font-size:44px}
    h2{margin:0 0 10px;font-size:20px}
    p{margin:0 0 14px;font-size:18px}
    .muted{color:var(--muted);font-size:16px}
    hr{border:0;border-top:1px solid var(--line);margin:22px 0}

    /* CTA */
    .cta{
      display:inline-block;
      margin:18px 0 26px;
      padding:12px 18px;
      border:1px solid #000;
      text-decoration:none;
      color:#000;
      font-size:16px;
    }
    .cta:hover{background:#000;color:#fff}

    /* Section */
    .section{margin-top:48px}

    /* Fear & Greed card */
    #fng{
      margin-top:36px;
      padding:14px 16px;
      border:1px solid var(--line);
    }
    .fng-row{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .badge{
      padding:4px 8px;
      border:1px solid var(--line);
      font-size:14px;
    }

    /* Fear & Greed colors */
    .fng-red { background:#ffe5e5; color:#8b0000; border-color:#f5c2c2; }
    .fng-orange { background:#fff1e0; color:#8a4b00; border-color:#ffd8b5; }
    .fng-green { background:#e8f5e9; color:#1b5e20; border-color:#c8e6c9; }
    .fng-darkgreen { background:#e0f2f1; color:#004d40; border-color:#b2dfdb; }
  </style>
</head>

<body>

  <h1>Cicil BTC</h1>

  <p><strong>Belajar mengumpulkan Bitcoin secara bertahap dan konsisten.</strong></p>

  <p>
    Cicil BTC adalah simulasi sederhana untuk membantu membangun kebiasaan,
    bukan untuk menebak harga atau mengatur waktu pasar.
  </p>

  <!-- CTA -->
  <a href="#simulasi" class="cta">Coba simulasi sederhana</a>

  <hr>

  <p class="muted">
    Ini bukan saran investasi.<br>
    Ini proyek pribadi untuk disiplin menabung jangka panjang—dibagikan sebagai referensi.
  </p>

  <!-- Fear & Greed -->
  <div id="fng" class="section">
    <h2>Fear &amp; Greed (harian)</h2>

    <div class="fng-row">
      <span class="muted">Index:</span>
      <strong id="fng-value">…</strong>
      <span id="fng-label" class="badge">Memuat…</span>
    </div>

    <p class="muted" id="fng-time">Update: …</p>
    <p class="muted">
      Digunakan sebagai konteks psikologi pasar, bukan instruksi beli/jual.
    </p>
  </div>

  <!-- Simulator -->
  <div id="simulasi" class="section">
    <h2>Simulator Cicil (Forward Only)</h2>
    <p class="muted">
      Simulasi dimulai dari hari ini. Tidak tersedia simulasi ke masa lalu.
    </p>

    <div style="margin-top:14px; padding:14px 16px; border:1px solid var(--line);">
      <p style="margin:0 0 10px;"><strong>Strategi cicil</strong></p>

      <label style="display:block; margin:0 0 8px;">
        <input type="radio" name="strategy" value="extreme" checked>
        Extreme Fear saja
      </label>

      <label style="display:block; margin:0 0 8px;">
        <input type="radio" name="strategy" value="fear">
        Fear + Extreme Fear
      </label>

      <hr style="margin:14px 0;">

      <p style="margin:0 0 10px;"><strong>Nominal per hari (IDR)</strong></p>

      <input id="amountIdr" type="number" inputmode="numeric" value="1000000"
        style="width:100%; padding:10px; border:1px solid var(--line); font-size:16px;">

      <p class="muted" style="margin-top:10px;">
        Nominal tetap sepanjang simulasi. Tidak ada aksi jual.
      </p>

      <a href="#simulasi" class="cta" id="runSimBtn">Jalankan simulasi</a>

      <div id="simResult" style="display:none; margin-top:16px;">
        <hr style="margin:14px 0;">
        <p style="margin:0 0 8px;"><strong>Hasil (hari ini)</strong></p>

        <p class="muted" style="margin:0 0 6px;">
          Fear &amp; Greed hari ini: <strong><span id="rFngValue">-</span></strong>
          — <span id="rFngLabel">-</span>
        </p>

        <p class="muted" style="margin:0 0 6px;">
          Harga BTC (USD) hari ini: <strong>$<span id="rBtcUsd">-</span></strong>
        </p>

        <p class="muted" style="margin:0 0 6px;">
          Dana disetor: <strong>Rp <span id="rFiat">-</span></strong>
        </p>

        <p class="muted" style="margin:0 0 6px;">
          BTC terkumpul: <strong><span id="rBtc">-</span> BTC</strong>
        </p>

        <p class="muted" style="margin:0 0 10px;">
          Nilai BTC (IDR): <strong>Rp <span id="rValueIdr">-</span></strong>
          <span id="rPnlBadge" class="badge" style="margin-left:8px;">-</span>
        </p>

        <p class="muted">
          Warna hanya menunjukkan hasil simulasi, bukan saran investasi.
        </p>
      </div>

    </div>
  </div>

  <!-- SCRIPTS (di bawah supaya elemen sudah ada) -->
  <script>
    function fmtIdr(n){
      return new Intl.NumberFormat('id-ID').format(Math.round(n));
    }
    function fmtUsd(n){
      return new Intl.NumberFormat('en-US', { maximumFractionDigits: 2 }).format(n);
    }

    async function getFngToday(){
      const res = await fetch('https://api.alternative.me/fng/?limit=1&format=json', { cache: 'no-store' });
      if(!res.ok) throw new Error('FNG HTTP ' + res.status);
      const json = await res.json();
      const d = json && json.data && json.data[0];
      if(!d) throw new Error('FNG no data');
      return { value: parseInt(d.value,10), label: d.value_classification, ts: Number(d.timestamp) * 1000 };
    }

    async function getBtcUsd(){
      const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd', { cache: 'no-store' });
      if(!res.ok) throw new Error('BTC HTTP ' + res.status);
      const json = await res.json();
      return Number(json.bitcoin.usd);
    }

    async function getUsdIdr(){
      const res = await fetch('https://api.exchangerate.host/latest?base=USD&symbols=IDR', { cache: 'no-store' });
      if(!res.ok) throw new Error('FX HTTP ' + res.status);
      const json = await res.json();
      return Number(json.rates.IDR);
    }

    function colorizeFngBadge(value, el){
      el.className = 'badge';
      if (value <= 24) el.classList.add('fng-red');
      else if (value <= 49) el.classList.add('fng-orange');
      else if (value <= 74) el.classList.add('fng-green');
      else el.classList.add('fng-darkgreen');
    }

    function shouldBuy(strategy, fngValue){
      if(strategy === 'extreme') return fngValue <= 24;
      if(strategy === 'fear') return fngValue <= 49;
      return false;
    }

    async function loadFngCard(){
      const v = document.getElementById('fng-value');
      const l = document.getElementById('fng-label');
      const t = document.getElementById('fng-time');

      try{
        const fng = await getFngToday();
        v.textContent = String(fng.value);
        l.textContent = fng.label;
        colorizeFngBadge(fng.value, l);

        const dt = new Date(fng.ts);
        t.textContent = 'Update: ' + dt.toLocaleString('id-ID');
      }catch(e){
        v.textContent = '—';
        l.textContent = 'Tidak tersedia';
        l.className = 'badge';
        t.textContent = 'Update: gagal ambil data (refresh halaman)';
        console.log('FNG card error:', e);
      }
    }

    async function runSim(){
      const amountIdr = Number(document.getElementById('amountIdr').value || 0);
      const strategy = document.querySelector('input[name="strategy"]:checked')?.value || 'extreme';
      const box = document.getElementById('simResult');
      box.style.display = 'none';

      if(amountIdr <= 0){
        alert('Nominal harus lebih dari 0');
        return;
      }

      try{
        const [fng, btcUsd, usdIdr] = await Promise.all([getFngToday(), getBtcUsd(), getUsdIdr()]);
        const buyToday = shouldBuy(strategy, fng.value);

        const fiat = buyToday ? amountIdr : 0;
        const btcBought = buyToday ? ((amountIdr / usdIdr) / btcUsd) : 0;
        const valueIdr = btcBought * btcUsd * usdIdr;

        document.getElementById('rFngValue').textContent = fng.value;
        document.getElementById('rFngLabel').textContent = fng.label;
        document.getElementById('rBtcUsd').textContent = fmtUsd(btcUsd);

        document.getElementById('rFiat').textContent = fmtIdr(fiat);
        document.getElementById('rBtc').textContent = btcBought.toFixed(8);
        document.getElementById('rValueIdr').textContent = fmtIdr(valueIdr);

        const pnlBadge = document.getElementById('rPnlBadge');
        pnlBadge.className = 'badge';
        if(valueIdr > fiat){
          pnlBadge.textContent = 'HIJAU';
          pnlBadge.classList.add('fng-green');
        } else if (valueIdr < fiat){
          pnlBadge.textContent = 'MERAH';
          pnlBadge.classList.add('fng-red');
        } else {
          pnlBadge.textContent = 'NETRAL';
        }

        box.style.display = 'block';

        // GA event
        if (typeof gtag === 'function') {
          gtag('event', 'sim_run', { 'event_category': 'engagement', 'event_label': strategy });
        }

      }catch(err){
        console.log(err);
        alert('Gagal ambil data. Coba refresh halaman.');
      }
    }

    // init after DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      loadFngCard();

      const btn = document.getElementById('runSimBtn');
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        runSim();
      });
    });
  </script>

</body>
</html>
